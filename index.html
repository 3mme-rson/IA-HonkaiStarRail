<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot Python - Assistente IA</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(180deg, #ffffff, #ffe5ef, #eaeefd, #e8fffa);
        color: #000000;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px;
      }

      .container {
        width: 100%;
        max-width: 900px;
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(148, 116, 173, 0.37);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 95vh;
      }

      .header {
        background: linear-gradient(to right, #ffbadc, #eabdff, #c0d6ff);
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
      }

      .header h1 {
        font-size: 1.8rem;
        margin-bottom: 5px;
      }

      .header p {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .python-logo {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2rem;
        color: hsl(338, 100%, 90%);
      }

      .chat-container {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .api-key-section {
        padding: 20px;
        background-color: #ffffff;
        border-bottom: 1px solid #ffd8ea;
      }

      .api-key-form {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .api-key-input {
        flex: 1;
        min-width: 200px;
        padding: 12px 15px;
        border: 1px solid #ffdaed;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .api-key-input:focus {
        outline: none;
        border-color: #dbe4ff;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
      }

      .api-selector {
        width: 100%;
        margin-bottom: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .api-selector select {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #ffd6eb;
        background-color: white;
      }

      .btn {
        padding: 12px 20px;
        background: linear-gradient(to right, #ffc6d7, #ffabd5);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn:hover {
        background: linear-gradient(to right, #f0b6ff, #e681ff);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .btn:active {
        transform: translateY(0);
      }

      .chat-box {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background-color: #f8f9fa;
      }

      .message {
        max-width: 80%;
        padding: 12px 18px;
        border-radius: 18px;
        line-height: 1.5;
        position: relative;
        animation: fadeIn 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-message {
        align-self: flex-end;
        background: linear-gradient(to right, #ffc6d7, #ffabd5);
        color: white;
        border-bottom-right-radius: 5px;
      }

      .bot-message {
        align-self: flex-start;
        background-color: white;
        color: #333;
        border: 1px solid #e4eeff;
        border-bottom-left-radius: 5px;
      }

      .warning-message {
        align-self: center;
        background-color: #d4efff;
        color: #677d97;
        border: 1px solid #b4caeb;
        border-radius: 8px;
        max-width: 90%;
        text-align: center;
        font-size: 0.9rem;
      }

      .error-message {
        align-self: center;
        background-color: #f8d7da;
        color: #a12268;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        max-width: 90%;
        text-align: center;
        font-size: 0.9rem;
      }

      .input-section {
        padding: 20px;
        background-color: white;
        border-top: 1px solid #ffffff;
        display: flex;
        gap: 10px;
        height: auto;
        float: left;
      }

      .message-input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid #ffebf6;
        border-radius: 25px;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .message-input:focus {
        outline: none;
        border-color: #ffdff2;
        box-shadow: 0 0 0 3px rgba(74, 100, 145, 0.2);
      }

      .send-btn {
        padding: 12px 20px;
        background: linear-gradient(to right, #ffc6d7, #ffabd5);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .send-btn:hover {
        background: linear-gradient(to right, #f0b6ff, #e681ff);
        transform: translateY(-2px);
      }

      .send-btn:active {
        transform: translateY(0);
      }

      .send-btn:disabled {
        background: #ff5a99;
        cursor: not-allowed;
        transform: none;
      }

      .typing-indicator {
        display: inline-block;
        padding: 12px 18px;
        background-color: white;
        border: 1px solid #e9ecef;
        border-radius: 18px;
        border-bottom-left-radius: 5px;
        align-self: flex-start;
      }

      .typing-dots {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #4a6491;
        animation: typing 1.4s infinite ease-in-out;
      }

      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes typing {
        0%,
        80%,
        100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .info-section {
        padding: 15px 20px;
        background-color: #e7f3ff;
        border-top: 1px solid #b3d9ff;
        font-size: 0.85rem;
        color: #0066cc;
        text-align: center;
      }

      .info-section a {
        color: #004d99;
        text-decoration: none;
        font-weight: 600;
      }

      .info-section a:hover {
        text-decoration: underline;
      }

      .code-block {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        overflow-x: auto;
        white-space: pre-wrap;
      }

      .api-info {
        margin-top: 10px;
        font-size: 0.8rem;
        color: #6c757d;
      }

      @media (max-width: 768px) {
        .container {
          height: 90vh;
        }

        .message {
          max-width: 90%;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .Honkai-logo {
          font-size: 1.5rem;
          top: 18px;
        }

        .api-key-form {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Chatbot Honkai Star Rail - Assistente Pompom (IA)</h1>
        <p>Obtenha ajuda com suas dúvidas sobre o jogo Honkai Star Rail perguntando ao nosso assistente de bordo Pompom!</p>
        <div class="Honkai-logo">✨</div>
      </div>

      <div class="chat-container">
        <div class="api-key-section">
          <div class="api-selector">
            <label for="apiProvider">Selecione a API:</label>
            <select id="apiProvider">
              <option value="gemini">
                Google Gemini (Recomendado - Gratuito)
              </option>
              <option value="deepseek">
                DeepSeek (Pode Requerer Pagamento)
              </option>
            </select>
          </div>
          <div class="api-key-form">
            <input
              type="password"
              class="api-key-input"
              placeholder="Digite sua chave da API..."
              id="apiKey"
            />
            <button class="btn" id="saveApiKey">Salvar Chave</button>
          </div>
          <div class="api-info" id="apiInfo">
            Para Google Gemini: Obtenha uma chave gratuita em
            <a href="https://aistudio.google.com/app/apikey" target="_blank"
              >Google AI Studio</a
            >
          </div>
        </div>

        <div class="chat-box" id="chatBox">
          <div class="message bot-message">
            Olá viajante estelar! Sou seu assistente de Bordo Pompom. Por favor, selecione uma API e
            insira sua chave para começarmos. Recomendo usar o Google Gemini que
            tem um plano gratuito generoso. Posso te ajudar com qualquer duvida sobre o Expresso Astral, Personagens, Elementos e tudo mais que envolva o universo de Honkai Star Rail.
          </div>
        </div>

        <div class="input-section">
          <input
            type="text"
            class="message-input"
            placeholder="Digite sua pergunta sobre Honkai Star Rail..."
            id="messageInput"
            disabled
          />
          <button class="send-btn" id="sendMessage" disabled>
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22 2L11 13"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M22 2L15 22L11 13L2 9L22 2Z"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>

        <div class="info-section">
          <strong>Google Gemini:</strong> Obtenha uma chave gratuita em
          <a href="https://aistudio.google.com/app/apikey" target="_blank"
            >Google AI Studio</a
          >
          | <strong>DeepSeek:</strong>
          <a href="https://platform.deepseek.com/api_keys" target="_blank"
            >DeepSeek Platform</a
          >
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const apiProviderSelect = document.getElementById("apiProvider");
        const apiKeyInput = document.getElementById("apiKey");
        const apiInfo = document.getElementById("apiInfo");
        const saveApiKeyBtn = document.getElementById("saveApiKey");
        const messageInput = document.getElementById("messageInput");
        const sendMessageBtn = document.getElementById("sendMessage");
        const chatBox = document.getElementById("chatBox");

        let apiKey = "";
        let apiProvider = "gemini";
        let isProcessing = false;

        // Atualizar informações da API quando o provedor mudar
        apiProviderSelect.addEventListener("change", function () {
          apiProvider = this.value;
          updateApiInfo();
        });

        function updateApiInfo() {
          if (apiProvider === "gemini") {
            apiInfo.innerHTML =
              'Para Google Gemini: Obtenha uma chave gratuita em <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>';
            apiKeyInput.placeholder = "Digite sua chave do Google Gemini...";
          } else {
            apiInfo.innerHTML =
              'Para DeepSeek: Obtenha uma chave em <a href="https://platform.deepseek.com/api_keys" target="_blank">DeepSeek Platform</a> (pode requerer pagamento)';
            apiKeyInput.placeholder = "Digite sua chave do DeepSeek...";
          }
        }

        // Inicializar informações da API
        updateApiInfo();

        // Salvar a chave da API
        saveApiKeyBtn.addEventListener("click", function () {
          apiKey = apiKeyInput.value.trim();

          if (!apiKey) {
            addMessage("Por favor, digite uma chave da API válida.", "warning");
            return;
          }

          // Esconder a chave na interface
          apiKeyInput.type = "password";
          apiKeyInput.value = "••••••••••••••••";
          apiKeyInput.disabled = true;
          saveApiKeyBtn.disabled = true;
          apiProviderSelect.disabled = true;

          // Ativar campos de mensagem
          messageInput.disabled = false;
          sendMessageBtn.disabled = false;

          addMessage(
            `Chave da API ${
              apiProvider === "gemini" ? "Google Gemini" : "DeepSeek"
            } salva com sucesso! Agora você pode fazer suas perguntas sobre Honkai Star Rail.`,
            "bot"
          );
          messageInput.focus();
        });

        // Enviar mensagem ao clicar no botão
        sendMessageBtn.addEventListener("click", sendMessage);

        // Enviar mensagem ao pressionar Enter
        messageInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !isProcessing) {
            sendMessage();
          }
        });

        async function sendMessage() {
          const message = messageInput.value.trim();

          if (!message || isProcessing) return;

          // Verificar se a pergunta é sobre Python
          if (!isHonkaiStarRailRelated(message)) {
            addMessage(
              "Por favor viajante, faça apenas perguntas relacionadas a Honkai Star Rail. Pompom só vai conseguir te ajudar com perguntas sobre Honkai.",
              "warning"
            );
            messageInput.value = "";
            return;
          }

          // Adicionar mensagem do usuário ao chat
          addMessage(message, "user");
          messageInput.value = "";

          // Mostrar indicador de digitação
          showTypingIndicator();

          // Processar a pergunta
          await processQuestion(message);
        }

        async function processQuestion(question) {
          isProcessing = true;
          sendMessageBtn.disabled = true;

          try {
            let response;

            if (apiProvider === "gemini") {
              response = await callGeminiAPI(question);
            } else {
              response = await callDeepSeekAPI(question);
            }

            // Remover indicador de digitação
            removeTypingIndicator();

            // Exibir a resposta
            addMessage(response, "bot");
          } catch (error) {
            console.error("Erro ao processar a pergunta:", error);
            removeTypingIndicator();

            let errorMessage =
              "Desculpe, ocorreu um erro ao processar sua pergunta. ";

            if (error.message.includes("402")) {
              errorMessage +=
                "A API selecionada requer pagamento. Por favor, use o Google Gemini que tem um plano gratuito.";
            } else if (error.message.includes("401")) {
              errorMessage +=
                "Chave da API inválida ou não autorizada. Verifique sua chave e tente novamente.";
            } else if (error.message.includes("429")) {
              errorMessage +=
                "Limite de requisições excedido. Tente novamente mais tarde.";
            } else if (error.message.includes("500")) {
              errorMessage +=
                "Erro interno do servidor. Tente novamente em alguns instantes.";
            } else {
              errorMessage += `Detalhes: ${error.message}`;
            }

            addMessage(errorMessage, "error");
          } finally {
            isProcessing = false;
            sendMessageBtn.disabled = false;
          }
        }

        async function callGeminiAPI(question) {
          // Usando a API do Google Gemini
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

          const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              contents: [
                {
                  parts: [
                    {
                      text: `Você é um assistente especializado em Honkai: Star Rail. Responda apenas perguntas relacionadas a Honkai: Star Rail, incluindo Caminhos, Relíquias, Cones de Luz, Otimização de Rotações de Habilidade, resolução de problemas (de build), boas práticas (de combate) e desenvolvimento de equipe (de personagem) com Estratégias de Batalha. Se a pergunta não for sobre Honkai: Star Rail, explique educadamente que você só pode ajudar com questões relacionadas a Honkai: Star Rail.

Pergunta do usuário: ${question}`,
                    },
                  ],
                },
              ],
              generationConfig: {
                temperature: 0.7,
                maxOutputTokens: 1000,
              },
            }),
          });

          if (!response.ok) {
            throw new Error(
              `Erro na API: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json();

          if (data.candidates && data.candidates.length > 0) {
            return data.candidates[0].content.parts[0].text;
          } else {
            throw new Error("Resposta da API não contém dados válidos");
          }
        }

        async function callDeepSeekAPI(question) {
          // Tentativa com a API DeepSeek (pode retornar erro 402)
          const response = await fetch(
            "https://api.deepseek.com/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${apiKey}`,
              },
              body: JSON.stringify({
                model: "deepseek-chat",
                messages: [
                  {
                    role: "system",
                    content:
                      "Você é um assistente especializado em Honkai: Star Rail. Responda apenas perguntas relacionadas a Honkai: Star Rail, incluindo Caminhos, Relíquias, Cones de Luz, Otimização de Rotações de Habilidade, resolução de problemas (de build), boas práticas (de combate) e desenvolvimento de equipe (de personagem) com Estratégias de Batalha. Se a pergunta não for sobre Honkai: Star Rail, explique educadamente que você só pode ajudar com questões relacionadas a Honkai: Star Rail."
                  },
                  {
                    role: "user",
                    content: question,
                  },
                ],
                max_tokens: 1000,
                temperature: 0.7,
              }),
            }
          );

          if (!response.ok) {
            throw new Error(
              `Erro na API: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json();

          if (data.choices && data.choices.length > 0) {
            return data.choices[0].message.content;
          } else {
            throw new Error("Resposta da API não contém dados válidos");
          }
        }

        function isHonkaiStarRailRelated(message) {
          const HonkaiStarRailKeywords = [
            "Caminhos",
            "Estação Espacial Herta",
            "Honkai Star Rail",
            "Xianzhou Luofu",
            "Belobog",
            "Penacony",
            "Destruição",
            "Caça",
            "Erudição",
            "Harmonia",
            "Abundância",
            "Preservação",
            "Nihilidade",
            "Físico",
            "Fogo",
            "Gelo",
            "Raio",
            "Vento",
            "Quântico",
            "Imaginário",
            "Expresso Astral",
            "Pompom",
            "Trailblazer",
            "Stellaron",
            "Caminho",
            "Eidolon",
            "Superposição",
            "Técnica",
            "Ultimate",
            "Habilidade",
            "Ataque Básico",
            "Trace",
            "Light Cone",
            "Relíquia",
            "Ornamento",
            "Gacha",
            "Warp",
            "Jades Estelares",
            "Créditos",
            "Nível de Equilíbrio",
            "Nível de Desbravador",
          ];

          const lowerMessage = message.toLowerCase();

          // Verificar se a mensagem contém palavras-chave relacionadas a Python
          return HonkaiStarRailKeywords.some((keyword) =>
            lowerMessage.includes(keyword.toLowerCase())
          );
        }

        function addMessage(text, sender) {
          const messageDiv = document.createElement("div");
          messageDiv.classList.add("message");

          if (sender === "user") {
            messageDiv.classList.add("user-message");
            messageDiv.textContent = text;
          } else if (sender === "bot") {
            messageDiv.classList.add("bot-message");

            // Processar a resposta para formatar blocos de código
            const formattedText = formatCodeBlocks(text);
            messageDiv.innerHTML = formattedText;
          } else if (sender === "warning") {
            messageDiv.classList.add("warning-message");
            messageDiv.textContent = text;
          } else if (sender === "error") {
            messageDiv.classList.add("error-message");
            messageDiv.textContent = text;
          }

          chatBox.appendChild(messageDiv);

          // Rolagem automática para a última mensagem
          chatBox.scrollTop = chatBox.scrollHeight;
        }

        function formatCodeBlocks(text) {
          // Substituir blocos de código marcados com ``` por elementos pre/code
          return text.replace(
            /```(\w+)?\n([\s\S]*?)```/g,
            function (match, language, code) {
              return `<div class="code-block"><pre><code>${code.trim()}</code></pre></div>`;
            }
          );
        }

        function showTypingIndicator() {
          const typingDiv = document.createElement("div");
          typingDiv.classList.add("typing-indicator");
          typingDiv.id = "typingIndicator";

          const dotsDiv = document.createElement("div");
          dotsDiv.classList.add("typing-dots");

          for (let i = 0; i < 3; i++) {
            const dot = document.createElement("div");
            dot.classList.add("typing-dot");
            dotsDiv.appendChild(dot);
          }

          typingDiv.appendChild(dotsDiv);
          chatBox.appendChild(typingDiv);

          // Rolagem automática para o indicador de digitação
          chatBox.scrollTop = chatBox.scrollHeight;
        }

        function removeTypingIndicator() {
          const typingIndicator = document.getElementById("typingIndicator");
          if (typingIndicator) {
            typingIndicator.remove();
          }
        }
      });
    </script>
  </body>
</html>
